# TODO database password

# TODO access database

# Create the following persistent volumes if they don't already exist

apiVersion: v1
kind: PersistentVolume
metadata:
  name: {{ template "node-app.fullname" $ }}-postgresql-pv
spec:
  capacity:
    storage: {{ .Values.postgresql.persistence.size }}
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  claimRef:
    name: durf-postgresql
    namespace: {{ .Release.Namespace }}
  hostPath:
    path: /var/volumes/{{ .Release.Name }}/postgresql
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: {{ template "node-app.fullname" $ }}-redis-pv
spec:
  capacity:
    storage: {{ .Values.redis.persistence.size }}
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  claimRef:
    name: durf-redis
    namespace: {{ .Release.Namespace }}
  hostPath:
    path: /var/volumes/{{ .Release.Name }}/redis

To get your user password run:

    PGPASSWORD=$(kubectl get secret --namespace {{ .Release.Namespace }} {{ .Release.Name }}-postgresql -o jsonpath="{.data.postgres-password}" | base64 --decode; echo)

Reclaim Volumes if needed:

   echo $(kubectl get pv/{{ template "node-app.fullname" $ }}-postgresql-pv -o yaml) | kubectl apply -f -
   echo $(kubectl get pv/{{ template "node-app.fullname" $ }}-redis-pv -o yaml) | kubectl apply -f -